<!-- Names: Chris Giuffrida, Thomas Krill, Michael Farren, Pedro Saunero -->
<!-- Data Structures Final Project:  #Emotionalyze -->

<!DOCTYPE html>
<html lang = 'en'>

<head>
    <meta charset='UTF-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>#Emotionalyze Results</title>

    <!-- Link favicon -->
    <link rel="icon" href="Website/images/Prism.png">

    <!-- Link Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Link bootstrap javascript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.js"></script>

    <!-- Link jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Link custom CSS syle sheets -->
    <link rel="stylesheet" type="text/css" href="Website/CSS/base/fonts.css">
    <link rel="stylesheet" type="text/css" href="Website/CSS/results.css">
</head>


<body style = "font-family: 'Graphik'">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="navbar-header">
            <a class="navbar-brand nav" href="#">
                <img alt = "Brand" src="Website/images/small-logo.png">
            </a>
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
            </button>
            <a class="navbar-brand" href="Website/homepage.html" style="color: white">#Emotionalyze</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="" data-toggle="modal" data-target="#about" style="color: white">About</a></li>
            <li><a href="" data-toggle="modal" data-target="#help"  style="color: white">Help</a></li>
          </ul>
        </div>
    </nav>



    <!-- About modal -->
    <div class="modal fade" id="about" tabindex="-1" role="dialog" aria-labelledby="info-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2 class="modal-title" id="myModalLabel">About #Emotionalyze</h2>
                </div>
                <div class="modal-body">
                #Emotionalyze leverages the power of the Twitter API and the IBM Watson API to give you insights into the emotional state of the country for a given topic.  The results page you are looking at has two sections.  The city result section of the results page uses a Google Map.  When the page first loads, circles will start to appear on the map.  Each circle encompasses a major city, with the circles loading in the order of population of the cities.  The color of the circle represents the most prominent emotion that city is feeling towards the search topic, using recent tweets as the data source.  Further, the saturation level of the color filling the circle reflects the level of intensity for that emotion.  The higher the saturation level (vibrant), the more intense the emotion.  The lower the saturation level (gray), the less intense the emotion.  When all twenty circles have appeared, the map will stop outputting new information, but the map will retain its state until a new search.  Below is the list of cities used to populate the map (in the order they appear):
                    <ul>
                        <li>New York City, NY</li>
                        <li>Los Angeles, CA</San>
                        <li>Chicago, IL</li>
                        <li>Dallas, TX</San>
                        <li>Houston, TX</li>
                        <li>Washington, D.C.</San>
                        <li>Philadelphia, PA</li>
                        <li>Miami, FL</San>
                        <li>Atlanta, GA</li>
                        <li>Boston, MA</San>
                        <li>San Francisco, CA</li>
                        <li>Phoenix, AZ</San>
                        <li>Detroit, MI</li>
                        <li>Seattle, WA</San>
                        <li>Minneapolis, MN</li>
                        <li>Denver, CO</San>
                        <li>St. Louis, MO</li>
                        <li>Portland, OR</San>
                        <li>Las Vegas, NV</San>
                        <li>Salt Lake City, UT</San>
                    </ul>
                At the same time the map is populating, #Emotionalyze is pulling tweets in real-time from an open Twitter stream.  The tweets are then analyzed.  Each tweet comes back with an emotional score from 0.0 to 1.0 for each of the five emotions: anger, disgust, fear, joy, and sadness.  Each tweet’s score for each emotion is used to determine an overall average score for each emotion.  These average emotional scores are displayed in the bar graph on the left.  Additionally, #Emotionalyze finds the strongest emotion for each tweet and keeps track of a count for the number of tweets that have each emotion present as the strongest.  These total counts are displayed in the pie chart on the right.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Help modal -->
    <div class="modal fade" id="help" tabindex="-1" role="dialog" aria-labelledby="info-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h2 class="modal-title" id="myModalLabel">#Emotionalyze Help</h2>
                </div>
                <div class="modal-body">
                If you are not seeing any results, or if real-time results are updating slowly, then you probably entered a search term that people are not actively tweeting about.  For best results, search words or phrases that are major topics today, or have been major topics within the past week.  Additionally, we suggest you try looking at Twitter's trending topics list to see the most tweeted topics at the given moment.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Results page-header-->
    <div class="page-header city-results-title">
        <h1>City Results</h1>
    </div>

    <!-- Google Map-->
    <div class="container">
        <div id="map-canvas" class="jumbotron"></div>
    </div> 

    <!-- Key for the cities map-->
    <div class="container">
        <div class="jumbotron map-key">
            <p>As #Emotionalyze analyzes tweets from twenty of the country's most prominent cities, circles will appear on the map.  Each circle represents the emotion that city is feeling.  The color indicates which of the five emotions was the strongest for the given city, and the saturation level of the specific color represents the strength of that emotion.  The more saturated (vibrant) the color, the more intense the emotion.  The less saturated (gray) the color, the less intense the emotion.</p>
        </div>
    </div>


    <!-- Real-time results page header-->
    <div class="page-header real-time-results">
        <h1>Real-Time Results</h1>
    </div>


    <!-- Graphs with descriptions-->
    <div class="container graphs">
        <div class="col-md-6">
            <canvas id="barChart" width="100" height="100"></canvas>
        </div>
        <div class="col-md-6">
            <canvas id="pieChart" width="300" height="300"></canvas>
        </div>
        <div class="col-md-6">
    <div class="container">
        <div class="jumbotron map-key">
            <p>As people tweet about the topic you searched, #Emotionalyze is pulling these tweets and using the five emotional scores for each tweet to determine an overall average for each emotion.  These averages are displayed in the bar graph on the left.  Additionally, #Emotionalyze is determining the strongest emotion present in each tweet and adding it to a running count for that emotion.  The total counts are displayed in the pie chart on the right.</p>
        </div>
    </div>
        </div>
    </div>


    <!-- Initialize Google Map-->
    <script>
        function initMap() {
            // Create the map.
            var map = new google.maps.Map(document.getElementById('map-canvas'), {
                zoom: 4,
                center: {lat: 37.090, lng: -95.712},
                mapTypeId: 'terrain',
                scrollwheel: false,
                streetViewControl: false,
                mapTypeControl: false,
                zoomControl: false,
                draggable: false
            });

            // Create 20 circle objects for the cities
            var circles = new Array();
            for(var i = 0; i < 20; i++) {
                circles.push(new google.maps.Circle({
                    radius: 160000,
                    fillOpacity: .85,
                    strokeOpacity: 1.0
                }));
            }

            // Make requests to the cities handler and add circles to the map as data for each city comes in
            var count = 0;
            setInterval(function(){
                var jsonResults;
                $.getJSON("http://localhost:8888/cities", function(json){
                    jsonResults = json;
                    if((jsonResults["cities"][count]["gotData"] == 1) && (count < 20)) {
                        circles[count].setOptions({fillColor: jsonResults["cities"][count]["color"],
                            strokeColor: jsonResults["cities"][count]["color"]});
                        circles[count].setCenter({lat: jsonResults["cities"][count]["lat"], lng: jsonResults["cities"][count]["lon"]})
                        circles[count].setMap(map);
                        count = count + 1;
                    }
                });
            },1);

        }
    </script>


    <!-- Initialize Bar Chart-->
    <script>
        var req = new XMLHttpRequest();
        req.open("GET", "localhost:8888/", true);
        Chart.defaults.global.defaultFontColor = "#01796f";
        Chart.defaults.global.defaultFontFamily = "'Graphik', sans-serif";
        Chart.defaults.global.defaultFontSize = 16;

        // Instantiate and set up the bar chart
        var ctx = document.getElementById("barChart");
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["Anger", "Disgust", "Fear", "Joy", "Sadness"],
                datasets: [{
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        'rgba(255, 0, 0, 1)',
                        'rgba(0, 255, 0, 1)',
                        'rgba(204, 0, 255, 1)',
                        'rgba(255, 191, 0, 1)',
                        'rgba(0, 0, 255, 1)'
                    ],
                    borderColor: [
                        'rgba(255, 0, 0, 1.0)',
                        'rgba(0, 255, 0, 1.0)',
                        'rgba(204, 0, 255, 1.0)',
                        'rgba(255, 191, 0, 1.0)',
                        'rgba(0, 0, 255, 1.0)'
                    ],
                    borderWidth: 3,
                    label:"Emotional Scores"
                }]
            },
            options: {
                title: {
                    display: true,
                    text: 'Average Emotional Scores',
                    fontSize: 25,
                    fontColor: "#01796f",
                    fontFamily: "'Graphik', sans-serif"
                },
                scales: {
                    yAxes: [{
                        ticks: {
                        beginAtZero:true,
                        max:0.5
                        }
                    }]
                }
            }
        });


        //Initialize pie chart
        var ctx = document.getElementById("pieChart");

        // Create data object to be passed to the pie chart
        var data = {
            labels: ["Anger", "Disgust", "Fear", "Joy", "Sadness"],
            datasets: [{
                data: [1, 1, 1, 1, 1],
                backgroundColor: [
                    "#ff0000",
                    "#00ff00",
                    "#cc00ff",
                    "#ffbf00",
                    "#0000ff"
                ],
                hoverBackgroundColor: [
                    "#ff0000",
                    "#00ff00",
                    "#cc00ff",
                    "#ffbf00",
                    "#0000ff"
                ]
            }]
        };


        var myDoughnutChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                animation:{
                    animateScale:true
                },
                title: {
                    display: true,
                    text: 'Most Common Emotions',
                    fontSize: 25,
                    fontColor: "#01796f",
                    fontFamily: "'Graphik', sans-serif"
                },
            }
        });


        // Make requests to the realtime handler and update the graph/pie chart as information comes in
        setInterval(function(){
            var jsonResults;
            //alert("hi");
            $.getJSON("http://localhost:8888/realtime", function(json){
                jsonResults = json;
                myChart.data.datasets[0].data[0] = jsonResults["average_emotions"]["anger"].toFixed(3);
                myChart.data.datasets[0].data[1] = jsonResults["average_emotions"]["disgust"].toFixed(3);
                myChart.data.datasets[0].data[2] = jsonResults["average_emotions"]["fear"].toFixed(3);
                myChart.data.datasets[0].data[3] = jsonResults["average_emotions"]["joy"].toFixed(3);
                myChart.data.datasets[0].data[4] = jsonResults["average_emotions"]["sadness"].toFixed(3);

                myDoughnutChart.data.datasets[0].data[0] = jsonResults["frequency_emotions"]["count"]["anger"];
                myDoughnutChart.data.datasets[0].data[1] = jsonResults["frequency_emotions"]["count"]["disgust"];
                myDoughnutChart.data.datasets[0].data[2] = jsonResults["frequency_emotions"]["count"]["fear"];
                myDoughnutChart.data.datasets[0].data[3] = jsonResults["frequency_emotions"]["count"]["joy"];
                myDoughnutChart.data.datasets[0].data[4] = jsonResults["frequency_emotions"]["count"]["sadness"];

                myChart.update();
                myDoughnutChart.update();
            });
        },1);
    </script>

    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLIv-SxFdthRJVAMhPuPYn3c_mIQcN2l0&callback=initMap">
    </script>

        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>

</body>
</html>
